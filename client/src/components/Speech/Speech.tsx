import { useEffect } from "react";
import styled from "styled-components";
import SpeechRecognition, {
  useSpeechRecognition,
} from "react-speech-recognition";

type Props = {
  autoStart?: boolean;
  onTranscribe: (value: string) => void;
};

export const Record = ({ onTranscribe, autoStart = false }: Props) => {
  const { finalTranscript, listening } = useSpeechRecognition();

  useEffect(() => {
    if (finalTranscript) {
      onTranscribe(finalTranscript);
    }
    if (autoStart && !listening) {
      SpeechRecognition.startListening();
    }
  }, [finalTranscript, listening, autoStart]);

  useEffect(() => {
    return () => {
      SpeechRecognition.abortListening();
    };
  }, []);

  if (!SpeechRecognition.browserSupportsSpeechRecognition()) {
    return <p>Voice is not supported</p>;
  }

  if (autoStart) {
    return listening ? <p>Speak to answer...</p> : null;
  }

  return (
    <Button type="button" onClick={() => SpeechRecognition.startListening()}>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10">
        <path
          fill="currentColor"
          fillRule="evenodd"
          d="M609.975,544.003535 C609.682,543.931156 609.667,543.931156 609.375,544.003535 C609.243,543.761999 609.286,543.603415 609.574,543.516397 C609.376,543.355373 609.511,543.052029 609.574,542.866608 C609.592,542.663294 609.421,542.612059 609.274,542.541306 C608.652,542.56977 609.133,543.003234 608.775,543.190282 C608.449,543.213053 608.563,542.876367 608.275,542.866608 C608.299,542.641336 608.646,542.680373 608.775,542.541306 C608.863,542.280252 608.445,542.429891 608.475,542.215192 C608.421,541.928114 608.829,542.015132 608.775,541.728053 C609.745,541.975282 610.484,543.068294 609.975,544.003535 Z M608.875,544.32965 C609.234,544.251577 609.052,544.680162 608.975,544.736276 C608.662,544.678535 608.844,544.518324 608.875,544.32965 Z M608.475,546.605945 C608.171,546.488023 607.793,546.521367 607.676,546.767782 C607.472,546.653114 607.773,546.488023 607.575,546.27983 C608.037,546.309921 608.15,546.379861 608.574,546.27983 C608.47,546.039921 608.123,545.997632 607.875,545.873204 C608.113,545.633294 608.237,545.301487 608.475,545.059951 C608.78,545.164861 608.975,545.358415 609.375,545.386065 C609.195,545.891096 608.773,546.197692 608.475,546.605945 Z M607.275,546.27983 C607.301,546.178174 607.475,546.197692 607.476,546.27983 C607.387,546.329439 607.297,546.378234 607.275,546.27983 Z M606.976,545.386065 C607.041,544.923324 607.293,544.613475 607.476,544.248324 C607.599,544.283294 607.681,544.351608 607.676,544.491487 C607.516,544.606156 607.42,544.771246 607.375,544.979439 C607.1,544.998144 607.34,545.438114 606.976,545.386065 Z M606.676,542.13468 L606.976,542.13468 C606.988,542.36971 607.402,542.275373 607.375,542.541306 C607.195,542.678746 606.871,542.473806 606.576,542.459981 C606.563,542.313596 606.698,542.288385 606.676,542.13468 Z M606.176,541.240102 C606.266,540.938385 607.076,541.055493 606.876,541.484891 C606.566,541.393806 606.606,541.020523 606.176,541.240102 Z M605.977,544.654951 C605.684,544.585011 606.036,544.393083 605.977,544.248324 C606.21,544.269469 606.033,544.606156 605.977,544.654951 Z M605.477,543.028445 C605.373,543.463535 605.537,543.616427 605.276,543.923023 C604.5,543.616427 605.092,542.760071 605.377,542.378656 C605.465,542.440463 605.603,542.466487 605.776,542.459981 C605.709,542.676306 605.619,542.873114 605.477,543.028445 Z M605.177,546.035041 C605.135,545.651186 605.518,545.60971 605.477,545.223415 C605.593,545.209589 605.654,545.241306 605.676,545.30474 C605.906,545.591818 605.678,546.08465 605.177,546.035041 Z M605.377,547.417571 C605.354,547.481005 605.374,547.577782 605.276,547.581035 C605.324,547.836397 605.135,547.898204 605.076,548.068174 C604.848,547.979529 605.176,547.66968 605.276,547.581035 C605.299,547.517602 605.279,547.420824 605.377,547.417571 C605.281,547.080885 605.676,547.401306 605.377,547.417571 Z M604.277,544.654951 C604.205,544.405282 604.379,544.358114 604.377,544.167812 C604.713,544.191397 604.775,544.439439 604.877,544.654951 C604.605,544.824921 604.628,544.469529 604.277,544.654951 Z M604.178,547.336246 C604.183,547.476126 604.1,547.544439 603.978,547.581035 L603.978,547.90471 C603.417,547.846156 603.133,547.561517 602.678,547.417571 C603.032,547.109349 603.258,547.591608 603.478,547.661547 C603.76,547.728234 603.736,547.547692 603.978,547.581035 C603.973,547.467993 604.024,547.401306 604.077,547.336246 L604.178,547.336246 C604.082,546.999559 604.477,547.319981 604.178,547.336246 Z M602.078,543.761186 C602.264,543.017059 603.035,542.750312 603.478,542.215192 C603.594,542.202993 603.655,542.23471 603.678,542.298144 C603.682,542.43965 603.658,542.548626 603.578,542.621818 C603.549,542.648656 603.404,542.594981 603.377,542.621818 C603.256,542.74462 603.05,542.991849 602.777,543.10977 C602.776,543.352933 602.518,543.386276 602.479,543.596909 C602.388,543.738415 602.254,543.910011 602.078,543.761186 Z M603.777,543.516397 C603.482,543.871788 603.097,544.1548 602.878,544.572812 C602.58,544.299559 603.167,544.053144 603.178,543.761186 C603.412,543.544861 603.608,543.298445 603.777,543.028445 C604.081,543.128475 603.669,543.308204 603.777,543.516397 Z M604.377,542.378656 C604.353,542.480312 604.178,542.459981 604.178,542.378656 C604.222,542.259921 604.266,542.386788 604.377,542.378656 Z M603.777,541.321427 C603.968,541.288083 603.958,541.088836 604.277,541.158776 C604.48,540.973355 605.107,541.130312 605.477,541.078264 C605.375,541.240102 605.304,541.425523 605.076,541.484891 C604.892,541.605252 604.927,541.903716 604.577,541.891517 C604.355,541.711788 604.676,541.558083 604.577,541.240102 C604.561,541.146577 604.419,541.15227 604.277,541.158776 C604.065,541.340132 604.025,541.65974 603.478,541.565403 C603.408,541.346638 603.684,541.408445 603.777,541.321427 Z M607.476,541.808565 L607.775,541.808565 C607.772,541.888264 607.652,541.871999 607.575,541.891517 L607.275,541.891517 C607.278,541.811818 607.398,541.828083 607.476,541.808565 Z M608.275,543.596909 C608.35,543.848204 608,543.75468 608.075,544.003535 C607.826,544.016547 607.766,543.876668 607.575,543.841698 C607.553,543.524529 607.79,543.41962 607.875,543.190282 C608.096,543.255343 608.125,543.474921 608.275,543.596909 Z M601.678,544.654951 C601.503,544.728144 601.496,544.939589 601.379,545.059951 C600.983,544.73465 601.658,544.588264 601.578,544.248324 C601.998,544.218234 601.65,544.511818 601.678,544.654951 Z M601.578,546.117993 C601.43,546.048053 601.363,545.913053 601.379,545.711367 C601.468,545.7748 601.604,545.798385 601.778,545.792692 C601.852,546.01471 601.58,545.956156 601.578,546.117993 Z M610.174,541.158776 C609.809,540.925373 609.457,541.160403 609.175,540.833475 C608.898,540.625282 608.444,540.560222 608.176,540.345523 C607.846,540.34227 607.678,540.208897 607.275,540.265011 C606.996,540.11212 606.822,539.873836 606.376,539.858385 L605.377,539.858385 C605.315,539.863264 605.258,539.870583 605.276,539.938897 C603.83,540.064951 603.099,540.770041 602.078,541.240102 C601.175,542.211939 600.242,543.160192 600.079,544.736276 L600.079,545.792692 C600.384,546.845041 601.077,547.582662 601.879,548.230824 C602.32,548.332481 602.549,548.607361 602.979,548.717963 C603.418,548.821246 603.73,549.027812 604.077,549.205915 C605.023,549.357993 605.871,549.58977 607.076,549.531216 C607.476,549.477541 607.761,549.329529 608.075,549.205915 C608.195,549.222993 608.137,549.296186 608.075,549.369379 L608.574,549.369379 C609.291,549.110764 609.742,548.639077 610.074,548.068174 C610.361,547.976276 610.664,547.896577 610.873,547.742873 C611.19,547.132933 611.535,546.546577 611.674,545.792692 L611.674,543.761186 C611.382,542.723475 610.873,541.863867 610.174,541.158776 L610.174,541.158776 Z"
          transform="translate(-600 -539.846)"
        />
      </svg>
    </Button>
  );
};

const Button = styled.button`
  width: 50px;
  height: 50px;

  > svg {
    width: 100%;
    height: 100%;
  }
`;
